webpackJsonp([1],{NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("7+uW"),s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"container"},[t("router-view")],1)},staticRenderFns:[]};var a=i("VU/8")({name:"app"},s,!1,function(e){i("lNBG")},null,null).exports,r=i("/ocq"),o=i("Ml+6"),h=i("Zrlr"),c=i.n(h),u=i("wxAW"),d=i.n(u),l=function(){function e(t){c()(this,e),this.windowSize=t,this.queue=new Array}return d()(e,[{key:"push",value:function(e){var t={x:e.x,y:e.y};this.queue.length<this.windowSize?this.queue.push(t):(this.queue.shift(),this.queue.push(t))}},{key:"getAvg",value:function(){if(0===this.queue.length)throw"Lenght of queue is zero";var e=this.queue.length;return this.queue.reduce(function(t,i){return t.x+=i.x/e,t.y+=i.y/e,t},{x:0,y:0})}},{key:"getVar",value:function(){if(0===this.queue.length)throw"Lenght of queue is zero";var e=this.queue.length,t=this.queue.reduce(function(e,t){return e+t.x*t.x},0),i=this.getAvg();return t/e-i.x*i.x}},{key:"getLast",value:function(){if(0===this.queue.length)throw"Lenght of queue is zero";return this.queue[this.queue.length-1]}},{key:"len",value:function(){return this.queue.length}},{key:"flush",value:function(){this.queue=[]}},{key:"_norm",value:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)}}]),e}(),p=function(){function e(){c()(this,e),this.laSensor=new LinearAccelerationSensor({frequency:60}),this.oriSensor=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"}),this.windowSize=32,this.offsetWindowSize=256,this.laSensor.addEventListener("reading",this.onReading.bind(this)),this.oriSensor.addEventListener("reading",this.onOriReading.bind(this)),this.ori=[0,0,0,0],this.speed=new l(this.windowSize),this.pos=new l(this.windowSize),this.lastAccel={x:0,y:0},this.accelOffset=new l(this.offsetWindowSize),this.accel=new l(this.windowSize),this.speed.push({x:0,y:0}),this.pos.push({x:0,y:0}),this.lastSensorTimeStamp=-1,this.laSensor.start(),this.oriSensor.start()}return d()(e,[{key:"onReading",value:function(e){function t(e,t,i,n){return{x:e.x+(t.x+i.x)/2*n,y:e.y+(t.y+i.y)/2*n}}var i=this.correctAccel(this.laSensor,this.ori);if(-1===this.lastSensorTimeStamp)this.lastSensorTimeStamp=this.laSensor.timestamp,this.accel.push(i),this.accelOffset.push(i);else{var n=(this.laSensor.timestamp-this.lastSensorTimeStamp)/1e3;if(this.accel.push(i),this.accelOffset.push(i),this.accel.len()===this.windowSize){i=this.accel.getAvg();var s=this.accelOffset.getAvg();i.x-=s.x,i.y-=s.y;var a=t(this.speed.getLast(),this.lastAccel,i,n);this.speed.push(a);var r=t(this.pos.getLast(),this.speed.getLast(),a,n);this.pos.push(r),this.lastAccel=i}this.lastSensorTimeStamp=this.laSensor.timestamp}}},{key:"onOriReading",value:function(){this.ori=this.oriSensor.quaternion}},{key:"readSpeed",value:function(){var e=this.speed.getAvg(),t=e.x,i=e.y;return{x:t,y:i,accuracy:Math.sqrt(this.speed.getVar()),norm:Math.sqrt(t*t+i*i),timestamp:this.lastSensorTimeStamp}}},{key:"readAccel",value:function(){var e=this.accel.getAvg(),t=e.x,i=e.y,n=this.accelOffset.getAvg(),s=Math.sqrt(this.accel.getVar());return{x:t-n.x,y:i-n.y,accuracy:s}}},{key:"readPosition",value:function(){var e=this.pos.getAvg();return{x:e.x,y:e.y,accuracy:Math.sqrt(this.pos.getVar())}}},{key:"reset",value:function(e){this.speed.flush(),this.speed.push(e),this.pos.flush(),this.pos.push({x:0,y:0}),this.accuracy=0}},{key:"correctAccel",value:function(e,t){var i={x:e.x,y:e.y,z:e.z},n=t[0],s=t[1],a=t[2],r=t[3],o=r*i.x+s*i.z-a*i.y,h=r*i.y+a*i.x-n*i.z,c=r*i.z+n*i.y-s*i.x,u=-n*i.x-s*i.y-a*i.z;return i.x=o*r+u*-n+h*-a-c*-s,i.y=h*r+u*-s+c*-n-o*-a,i.z=c*r+u*-a+o*-s-h*-n,i}}]),e}(),m=function(){function e(){c()(this,e),this.speedSensor=new p,this.geo_options={enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3},this.watchID=navigator.geolocation.watchPosition(this._updateCurrentPositionKalman.bind(this),this._handleError.bind(this),this.geo_options),this.posUpdateCB=function(){},this.currentPosition={x:NaN,y:NaN,longitude:NaN,latitude:NaN,accuracy:NaN,variance:NaN,timestamp:NaN},this.speedFromGPS={x:0,y:0},this.ready=!1}return d()(e,[{key:"watchPosition",value:function(e){this.posUpdateCB=e}},{key:"getPosition",value:function(e){if(!1===this.ready)navigator.geolocation.getCurrentPosition(function(t){this._updateCurrentPositionKalman(t);var i=this.currentPosition,n=i.x,s=i.y,a=i.accuracy;e({x:n,y:s,accuracy:a})}.bind(this),this._handleError.bind(this),this.geo_options);else{var t=this.currentPosition,i=t.x,n=t.y,s=t.accuracy;e({x:i,y:n,accuracy:s})}}},{key:"_updateCurrentPositionKalman",value:function(e){var t=e.coords.accuracy,i=this.currentPosition,n=i.timestamp,s=i.latitude,a=i.longitude,r=i.variance,o=i.x,h=i.y,c=this._convertGeolocation(e.coords);if(t<1&&(t=1),!1===this.ready)n=e.timestamp,s=e.coords.latitude,a=e.coords.longitude,r=t*t,o=c.x,h=c.y,this.ready=!0;else{if(e.timestamp-n>0){var u=this.speedSensor.readPosition().accuracy;r+=u*u,n=e.timestamp}var d=this.speedSensor.readPosition();null!==e.coords.speed&&null!==e.coords.heading&&(this.speedFromGPS={x:e.coords.speed*Math.cos(this.radians(e.coords.heading)+Math.PI/2),y:e.coords.speed*Math.sin(this.radians(e.coords.heading)+Math.PI/2)}),this.speedSensor.reset(this.speedFromGPS);var l=r/(r+t*t),p={x:o+d.x,y:h+d.y};o+=l*(c.x-p.x),h+=l*(c.y-p.y),r*=1-l}t=Math.sqrt(r),this.currentPosition={x:o,y:h,latitude:s,longitude:a,accuracy:t,variance:r,timestamp:n},this.posUpdateCB({x:o,y:h,accuracy:t})}},{key:"_handleError",value:function(e){console.log("[Geolocator] "+e.code+" "+e.message)}},{key:"detatch",value:function(){navigator.geolocation.clearWatch(this.watchID)}},{key:"_convertGeolocation",value:function(e){var t=e.longitude,i=e.latitude,n=6371e3;return t=this.radians(t),{x:n*(i=this.radians(i))*1,y:-n*t*Math.cos(23.5)*1}}},{key:"_convertGeolocationTWD97",value:function(e){var t=e.longitude,i=e.latitude,n=this.radians(t),s=this.radians(i),a=6378137,r=6356752.314245,o=this.radians(121),h=.9999,c=Math.sqrt(1-r*r/(a*a)),u=c*c/(1-c*c),d=a/Math.sqrt(1-c*c*(Math.sin(s)*Math.sin(s))),l=n-o,p=(6367449.145823325*s-16038.508663110888*Math.sin(2*s)+16.832613263433466*Math.sin(4*s)-.02198440406313031*Math.sin(6*s)+.0003127052153150434*Math.sin(8*s))*h+h*d*Math.sin(2*s)/4*(l*l)+h*d*Math.sin(s)*Math.pow(Math.cos(s),3)/24*(5-Math.tan(s)*Math.tan(s)+9*u*(Math.cos(s)*Math.cos(s))+u*u*4*Math.pow(Math.cos(s),4))*(l*l*l*l),m=h*d*Math.cos(s)*l+h*d*Math.pow(Math.cos(s),3)/6*(1-Math.tan(s)*Math.tan(s)+u*(Math.cos(s)*Math.cos(s)))*(l*l*l)+25e4;return{x:m*=1,y:p*=1}}},{key:"radians",value:function(e){return e*Math.PI/180}}]),e}(),v=function(){function e(t){c()(this,e),this.camera=t,this.options={frequency:60,referenceFrame:"device"},this.sensor=new AbsoluteOrientationSensor(this.options),this.sensor.addEventListener("reading",this.handleSensorReading.bind(this)),this.sensor.addEventListener("error",this.handleSensorError.bind(this)),this.quaternion=new o.f,this.sensor.start(),this.geolocator=new m,this.geolocator.watchPosition(this.handleGeolocationUpdate.bind(this)),this.currentPosition={x:0,y:0},this.newPosition={x:0,y:0},this.isLocationFixed=!1}return d()(e,[{key:"handleSensorReading",value:function(){this.quaternion.fromArray(this.sensor.quaternion)}},{key:"handleSensorError",value:function(){"NotReadableError"==event.error.name?console.log("[GeoAR control]Sensor is not available."):console.log("[GeoAR control]"+event.error.name)}},{key:"handleGeolocationUpdate",value:function(e){var t=e.x,i=e.y;!1===this.isLocationFixed&&(this.currentPosition.x=t,this.currentPosition.y=i,this.isLocationFixed=!0),this.newPosition.x=t,this.newPosition.y=i}},{key:"update",value:function(){this.camera.quaternion.copy(this.quaternion);this.currentPosition.x=.5*this.currentPosition.x+.5*this.newPosition.x,this.currentPosition.y=.5*this.currentPosition.y+.5*this.newPosition.y,this.camera.position.x=this.currentPosition.x,this.camera.position.y=this.currentPosition.y}}]),e}(),f={name:"AR_view",data:function(){return{camera:null,scene:null,axesHelper:null,vground:null,renderer:null,controls:null,spriteMaterial:null,geolocator:null,cameraHeight:1.4,cameraFoV:67.35,started:!1,cameraReady:!1}},methods:{initCamera:function(){var e=this;this.getCameraStream(function(){e.cameraReady=!0})},initAR:function(){if(this.started=!0,this.$refs.capture.videoHeight>window.innerHeight){var e=window.innerHeight/capture.videoHeight;this.cameraFoV=180/Math.PI*2*Math.atan(18*e/27)}this.camera=new o.e(this.cameraFoV,window.innerWidth/window.innerHeight,1,1100),this.camera.position.set(0,0,this.cameraHeight),this.controls=new v(this.camera),this.scene=new o.g;var t=new o.b(1e3,1e3,.001,100,100,1),i=new o.d({color:11184810,wireframe:!0});this.vground=new o.c(t,i),this.vground.position.set(0,0,0),this.scene.add(this.vground),this.axesHelper=new o.a(1),this.axesHelper.position.set(0,0,0),this.scene.add(this.axesHelper);var n=(new o.j).load("/static/media/placeholder.png");this.spriteMaterial=new o.i({map:n,color:16777215}),this.renderer=new o.k({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.$refs.content.appendChild(this.renderer.domElement),window.addEventListener("resize",this.onWindowResize,!1),this.animate()},animate:function(){window.requestAnimationFrame(this.animate.bind(this)),this.controls.update(),this.axesHelper.position.x=this.camera.position.x,this.axesHelper.position.y=this.camera.position.y,null!==this.vground&&(this.vground.position.x=this.camera.position.x,this.vground.position.y=this.camera.position.y),this.renderer.render(this.scene,this.camera)},addMarker:function(){var e=this.camera.position,t=e.x,i=e.y,n=new o.h(spriteMaterial);n.position.set(t,i,0),n.scale.set(.5,.5,.5),this.scene.add(n)},onWindowResize:function(){getCameraStream(function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)})},getCameraStream:function(e){navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{height:{min:window.innerHeight},facingMode:{exact:"environment"}}}).then(function(t){this.$refs.capture.srcObject=t,e()}.bind(this)).catch(function(e){console.log(e),alert("Get webcam error:\n  "+e.name+":"+e.constraint)})}},created:function(){this.initCamera()}},y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{ref:"content",attrs:{id:"content"}},[i("video",{ref:"capture",attrs:{autoplay:"",id:"capture"}})]),e._v(" "),i("div",{attrs:{id:"overlay"}},[e.cameraReady&&!e.started?i("div",{ref:"start",staticClass:"btn",on:{click:e.initAR}},[e._v("\n      Start\n    ")]):e._e(),e._v(" "),e._e()])])},staticRenderFns:[]};var g=i("VU/8")(f,y,!1,function(e){i("ORVs")},"data-v-c444fbfa",null).exports,w={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("h1",[e._v("List of Routes: ")]),e._v(" "),i("div",{staticClass:"content"},e._l(e.items,function(t){return i("router-link",{key:t.name,staticClass:"link",attrs:{to:t.path}},[e._v("\n            "+e._s(t.name)+" : "+e._s(t.path)+"\n        ")])}),1)])},staticRenderFns:[]};var x=i("VU/8")({name:"list_routes",mounted:function(){var e=this;this.$router.options.routes.forEach(function(t){e.items.push({name:t.name,path:t.path})})},data:function(){return{items:[]}}},w,!1,function(e){i("YDuV")},"data-v-bda62838",null).exports;n.a.use(r.a);var S=new r.a({routes:[{path:"/",name:"Developing Index",component:x},{path:"/ar_example",name:"AR example",component:g}]});S.beforeEach(function(e,t,i){document.title="Vireality - "+e.name,i()});var M=S,P=i("zYwr"),q=i("8p73"),_=i("D/aF");Object(P.a)(/\.css$/,new q.b({cacheName:"css-cache"})),Object(P.a)(/\.(?:png|jpg|jpeg|svg|gif)$/,new q.a({cacheName:"image-cache",plugins:[new _.a({maxEntries:20,maxAgeSeconds:604800})]})),new n.a({el:"#app",router:M,components:{App:a},template:"<app />"})},ORVs:function(e,t){},YDuV:function(e,t){},lNBG:function(e,t){}},["NHnr"]);